<!DOCTYPE html>
<!-- saved from url=(0056)http://visjs.org/examples/network/edgeStyles/arrows.html -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Network | Basic usage</title>

    <script type="text/javascript" src="./Network _ Basic usage_files/vis.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <link href="./Network _ Basic usage_files/vis-network.min.css" rel="stylesheet" type="text/css">

    <style type="text/css">
        #mynetwork {
            width: 1024px;
            height: 768px;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>

<p>
    There are a lot of options with arrows! They can also be combined with dashed lines.

    <button onclick="draw(data.exchs.slice(n, ++n));">NEXT MESSAGE</button>
    <button onclick="draw(data.exchs.slice(n, data.exchs.size));">ALL MESSAGES</button>
    <button onclick="network.stopSimulation();">FREEZE</button>
</p>

<div id="mynetwork">
    <div class="vis-network" tabindex="900"
         style="position: relative; overflow: hidden; touch-action: pan-y; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%;">
        <canvas width="1024" height="768"
                style="position: relative; touch-action: none; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%;"></canvas>
    </div>
</div>

<script type="text/javascript">
    var nodes = new vis.DataSet();
    var edges = new vis.DataSet();
    var actorIdMap = new Map();

    actorIdMap.set("EventStream", 1);
    nodes.add({id: 1, label: "Bus"})

    function draw(exchs) {
        exchs.forEach(function (exch) {
            console.log(exch);
            if (!actorIdMap.has(exch.sender)) {
                var t = exch.sender.split("/").reverse()[0];
                if (t.indexOf("-") !== -1) {
                    t = t.split("-")[0];
                }
                nodes.add({id: actorIdMap.size + 1, label: t});
                actorIdMap.set(exch.sender, actorIdMap.size + 1);
            }

            exch.receiver.forEach(function (receiver) {
                if (!actorIdMap.has(receiver)) {
                    var t = receiver.split("/").reverse()[0];
                    if (t.indexOf("-") !== -1) {
                        t = t.split("-")[0];
                    }
                    nodes.add({id: actorIdMap.size + 1, label: t});
                    actorIdMap.set(receiver, actorIdMap.size + 1);
                }
            });
        });

        console.log(nodes);
        console.log(actorIdMap);

        exchs.forEach(function (exch) {
            var senderId = actorIdMap.get(exch.sender);
            var name = exch.message.split("(")[0];

            if (exch.bus) {
                var anyMatch = false
                edges.forEach(function (edge) {
                    if (edge.from === senderId && edge.to === 1 && edge.label === name) {
                        edge.value += 1;
                        anyMatch = true;
                        edges.update(edge)
                    }
                });

                if (!anyMatch) {
                    edges.add({from: senderId, to: 1, value: 0, arrows: 'to', label: name});
                }

                senderId = 1
            }

            exch.receiver.forEach(function (receiver) {
                var receiverId = actorIdMap.get(receiver);
                var anyMatch = false
                edges.forEach(function (edge) {
                    if (edge.from === senderId && edge.to === receiverId && edge.label === name) {
                        edge.value += 1;
                        anyMatch = true;
                        edges.update(edge)
                    }
                });

                if (!anyMatch) {
                    edges.add({from: senderId, to: receiverId, value: 0, arrows: 'to', label: name});
                }

            });
        });
    }

    // create a network
    var container = document.getElementById('mynetwork');
    var data2 = {
        nodes: nodes,
        edges: edges
    };
    var options = {
//        layout: {
//            hierarchical: {
//                direction: 'UD'
//            }
//        }
//        physics:false
        configure: {
            enabled: true,
            showButton: true
        },
        "physics": {
            "forceAtlas2Based": {
                "avoidOverlap": 0.8
            },
            "solver": "forceAtlas2Based"
        },
        nodes: {
            shape: 'box',
            scaling:{
                label: {
                    min:8,
                    max:20
                }
            }
        },
        "edges": {
            "smooth": {
                "roundness": 1
            }
        }
    };

    var network = new vis.Network(container, data2, options);
    var data;
    var n = 1;

    $.getJSON("http://localhost:8080/visualizer/get", function (d) {
        data = d;
        console.log(data)
        draw(data.exchs.slice(0, 1));
    })
</script>


<div style="display: block; opacity: 1;"></div>
</body>
</html>